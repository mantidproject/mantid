#!/bin/bash

# Download and install pixi (if it isn't installed)
install_pixi() {
  # configure the path to where pixi will end up
  if [[ "$OSTYPE" != darwin* && -f ~/.bashrc ]]; then
    . ~/.bashrc
  else
    export PATH="$PATH:$HOME/.pixi/bin"
  fi

  # check if pixi is not installed
  if [ "$(command -v pixi)" ]; then
      echo "updating previously installed pixi"
      pixi self-update --no-progress --quiet
  else
    echo "install pixi"
    set +x # don't care about details of pixi install
    curl -fsSL https://pixi.sh/install.sh | sh
    set -x # turn logging back on
    # source bashrc for updated PATH
    . ~/.bashrc
    # Verify pixi was installed successfully
    if [ ! -f "$HOME/.pixi/bin/pixi" ]; then
      echo "ERROR: pixi installation failed"
      exit 1
    fi
  fi
  if which pixi ; then
    echo "using $(pixi --version)"
  else
    echo "ERROR: pixi command not found"
    exit 1
  fi
}
