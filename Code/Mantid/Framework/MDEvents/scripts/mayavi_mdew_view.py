""" Experimental script for visualizing MDEventWorkspace
using Mayavi.

@author Janik Zikovsky"""

#This line has to be first for some reason.
from enthought.mayavi import mlab

import os
import sys
sys.path.append("/home/8oz/Code/Mantid/Code/Mantid/bin")
from MantidFramework import mtd
mtd.initialise()
from mantidsimple import *
import time
import numpy as np

LoadEventNexus(Filename="CNCS_7860_event.nxs",OutputWorkspace="cncs",SingleBankPixelsOnly="0",Precount="1")
eew = mtd["cncs"]
ew = eew._getHeldObject()

######################################################################
#Python Script Generated by Algorithm History Display 
######################################################################
LoadEventNexus(Filename="/home/8oz/data/TOPAZ_2511_event.nxs",OutputWorkspace="topaz",SingleBankPixelsOnly="0",Precount="1")
eew = mtd["topaz"]
ew = eew._getHeldObject()



MakeDiffractionMDEventWorkspace(InputWorkspace="topaz",OutputWorkspace="topaz_md")
aa = mtd["topaz_md"]
a = aa._getHeldObject()

# How it gets binned
xbins = 100
ybins = 100
zbins = 100
min = -6
max = +6
x = "Qx, %f, %f,  %d" % (min,max,xbins)
y = "Qy, %f, %f,  %d" % (min,max,ybins)
z = "Qz, %f, %f,  %d" % (min,max,zbins)
start = time.time()
alg = BinToMDHistoWorkspace(InputWorkspace="topaz_md", OutputWorkspace="topaz_mdhisto", DimX=x, DimY=y, DimZ=z, DimT="NONE,0,10,1")
print time.time()-start, " secs to bin."

bb = mtd["topaz_mdhisto"]
b = bb._getHeldObject()

data = b.getSignalDataVector()
data = np.array(data)
data = data.reshape( (xbins, ybins, zbins) )
f = open("tempdata.dat")
data.tofile(f)
f.close()


for i in xrange(4):
    mlab.figure(i)
    contour_val = 10**i
    mlab.gcf().name = "Threshold = %f" % contour_val
    mlab.contour3d(data, contours=[ contour_val  ])


#
#######################################################################
##Python Script Generated by Algorithm History Display 
#######################################################################
#LoadEventNexus(Filename="/home/8oz/data/TOPAZ_2511_event.nxs",OutputWorkspace="top_2511",SingleBankPixelsOnly="0",Precount="1")
#CompressEvents(InputWorkspace="top_2511",OutputWorkspace="top_2511",Tolerance="0.050000000000000003")
#
#MakeDiffractionMDEventWorkspace(InputWorkspace="top_2511",OutputWorkspace="mdew")
#BinToMDHistoWorkspace(InputWorkspace="top_2511_md",DimX="Qx,-10,10,50",DimY="Qy,-10,10,50",DimZ="Qz,-10,10,50",DimT="NONE,0,10,1",OutputWorkspace="top_histo")
